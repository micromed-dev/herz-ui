import{__assign as t}from"../../_virtual/_tslib.js";import{jsxs as e,jsx as n}from"theme-ui/jsx-runtime";import{get as r}from"theme-ui";import i,{useCallback as o,useRef as c,useState as a,useEffect as s}from"react";import u from"react-dom";var d;!function(t){t.WITH_OVERFLOW="overflow-herz-mobile-modal",t.WITHOUT_OVERFLOW="herz-mobile-modal"}(d||(d={}));var l=function(l){var f=l.backgroundStyles,p=l.children,h=l.dismissible,g=void 0!==h&&h,m=l.draggable,b=void 0!==m&&m,v=l.modalStyles,w=l.onClose,y=l.onDismiss,x=l.onOpen,O=l.open,T=void 0!==O&&O,H=l.overflowHeight,z=void 0===H?0:H,S=l.threshold,Y=void 0===S?.7:S,W=l.topSpacing,E=void 0===W?80:W,I=o((function(){if(L.current){var t=L.current.getClientRects()[0].height,e=window.innerHeight-t;return e>E?e:E}return E}),[E,p]),R=c(document.querySelector("body")),k=c(R.current.style.overflow),A=c(document.createElement("div")),D=c(null),C=c(0),_=c(new Date),F=c(!0),L=c(null),M=c(new Date),V=c(0),P=a({isAnimating:!1,isDragging:!1,isScrolling:!1,isOpen:!1}),j=P[0],q=P[1];function B(e){if(e.stopPropagation(),j.isScrolling)q(t(t({},j),{isScrolling:!1}));else if(L.current){var n=(C.current-V.current)/(_.current.getTime()-M.current.getTime()),r=C.current-V.current,i=I()*Y,o=!j.isOpen&&r<0,c=j.isOpen&&r>0,a=!0,s=j.isOpen;(Math.abs(r)>i||Math.abs(n)>.5)&&(o||c)?o?(a=C.current-V.current!=0,L.current.style.transition="transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)",L.current.style.transform="translateY(".concat(I(),"px)"),C.current=I(),s=!0,x&&x()):(a=C.current-V.current!=0,L.current.style.transition="transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)",L.current.style.transform="translateY(".concat(window.innerHeight-z,"px)"),C.current=window.innerHeight-z,s=!1):(a=C.current-V.current!=0,L.current.style.transform="translateY(".concat(j.isOpen?I():window.innerHeight-z,"px)"),C.current=j.isOpen?I():window.innerHeight-z),q(t(t({},j),{isAnimating:a,isDragging:!1,isOpen:s}))}}function U(e){if(e.stopPropagation(),!j.isScrolling)if(j.isOpen&&0!==e.currentTarget.scrollTop)q(t(t({},j),{isScrolling:!0}));else if(_.current=new Date,L.current){var n=e.touches[0].clientY,r=n-V.current,i=(j.isOpen?I():window.innerHeight-z)+r;i>=I()&&i<=window.innerHeight-z&&(L.current.style.transform="translateY(".concat(i,"px)")),C.current=n}}function G(e){e.stopPropagation(),R.current.style.overflow="hidden";var n=e.touches[0].clientY;C.current=n,M.current=new Date,V.current=n,q(t(t({},j),{isDragging:!0}))}function J(e){e.target===L.current&&(L.current&&b&&(L.current.style.transition="none"),q(t(t({},j),{isAnimating:!1})),!j.isOpen&&w&&w())}return s((function(){var t=R.current,e=k.current,n=A.current;return document.querySelectorAll('body > div[data-divtype="'.concat(d.WITH_OVERFLOW,'"]')).length>0&&z&&console.warn("You are using another mobile modal with overflowHeight different from 0. You must control which one is rendered to avoid covering one with the another."),A.current.setAttribute("role","presentation"),A.current.setAttribute("data-divtype",z?d.WITH_OVERFLOW:d.WITHOUT_OVERFLOW),Object.assign(A.current.style,{backgroundColor:"transparent",left:"0",position:"fixed",top:"0",zIndex:"1300"}),t.append(A.current),function(){t.style.overflow=e,n.remove()}}),[z]),s((function(){j.isOpen?R.current.style.overflow="hidden":R.current.style.overflow=k.current}),[b,j.isOpen]),s((function(){L.current&&!b&&(F.current?(T&&(L.current.style.transition="transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)",L.current.style.transform="translateY(".concat(I(),"px)"),q((function(e){return t(t({},e),{isAnimating:!0,isOpen:T})}))),F.current=!1):(T?(L.current.style.transition="transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)",L.current.style.transform="translateY(".concat(I(),"px)")):(L.current.style.transition="transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)",L.current.style.transform="translateY(".concat(window.innerHeight-z,"px)")),q((function(e){return t(t({},e),{isAnimating:e.isAnimating||e.isOpen!==T,isOpen:T})}))))}),[b,T,z,I]),u.createPortal(e(i.Fragment,{children:[n("div",{"data-testid":"test-background",onTouchEnd:y||g?function(){y&&y(),g&&!T&&(q(t(t({},j),{isAnimating:!0,isOpen:!1})),L.current&&(L.current.style.transition="transform  0.6s cubic-bezier(0.16, 1, 0.3, 1)",L.current.style.transform="translateY(".concat(window.innerHeight-z,"px)")))}:void 0,ref:D,sx:t({"@keyframes fadeIn":{"0%":{opacity:0},"100%":{opacity:1}},"@keyframes fadeOut":{"0%":{opacity:1},"100%":{opacity:0}},animation:j.isOpen||T||j.isDragging?"0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards fadeIn":"0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards fadeOut",backgroundColor:"text.alpha.40",height:"100vh",left:0,position:"fixed",top:0,minWidth:"100vw",visibility:j.isAnimating||j.isDragging||j.isOpen||T?"visible":"hidden",zIndex:4},f)}),!z&&b&&n("div",{"data-testid":"test-expand-touch-area",id:"extends-touch-area",onTouchEnd:B,onTouchMove:U,onTouchStart:G,onTransitionEnd:J,sx:{background:"transparent",bottom:0,height:"".concat(z+32,"px"),left:0,position:"fixed",width:"100vw",zIndex:-1}}),e("div",{"data-testid":"test-modal",onTouchEnd:b?B:void 0,onTouchMove:b?U:void 0,onTouchStart:b?G:void 0,onTransitionEnd:J,ref:L,sx:t({backgroundColor:"#fff",borderColor:"text.90",borderRadius:(j.isOpen||T)&&L.current&&L.current.getClientRects()[0].height===window.innerHeight&&!E?0:8,borderBottomLeftRadius:0,borderBottomRightRadius:0,borderStyle:"solid",borderWidth:"1px",boxShadow:"main",left:0,height:E?"fit-content":"100vh",maxHeight:"calc(100vh - ".concat(E,"px)"),minWidth:"100vw",overflowY:j.isOpen?"auto":"hidden",padding:8,paddingTop:b?0:9,position:"fixed",top:0,transform:"translateY(".concat(window.innerHeight-z,"px)"),zIndex:5},v),children:[b&&n("header",{onTouchEnd:b?B:void 0,onTouchMove:b?U:void 0,onTouchStart:b?G:void 0,sx:{backgroundColor:"#fff",height:48,position:"sticky",top:0,width:"100%",zIndex:6,"&::before":{boxSizing:"border-box",border:function(t){return"2px solid ".concat(r(t,"colors.text.90"))},borderRadius:1,content:'""',display:"block",height:0,left:"calc((100% - 40px) / 2)",position:"relative",top:5,width:40}}}),p]})]}),A.current)};export{l as default};
//# sourceMappingURL=MobileModal.js.map
