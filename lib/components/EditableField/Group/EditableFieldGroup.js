import{__assign as e}from"../../../_virtual/_tslib.js";import{jsx as t}from"react/jsx-runtime";import{useReducer as r,useCallback as n,useMemo as a}from"react";import{EditableFieldGroupContext as s}from"./Context.js";var u,i={isFocused:!1,hasChanged:!1,fields:{}};function l(t,r){var n,a;switch(r.type){case u.Focus:return e(e({},t),{isFocused:!0});case u.Reset:return Object.values(t.fields).forEach((function(e){return setTimeout(e.reset)})),e(e({},t),{isFocused:!1});case u.Blur:var s=r.payload,i=s.event,l=s.reset,o=void 0!==l&&l;if(i){var d=i.relatedTarget,c=Object.values(t.fields).some((function(e){var t;return d&&(null===(t=e.ref.current)||void 0===t?void 0:t.contains(d))}));return!c&&o&&Object.values(t.fields).forEach((function(e){return setTimeout(e.reset)})),e(e({},t),{isFocused:c})}return e(e({},t),{isFocused:!1});case u.Register:var f=r.payload,v=f.disableActionsOnBlur,p=f.name,h=f.ref;o=f.reset;return e(e({},t),{fields:e(e({},t.fields),(n={},n[p]=e(e({},t.fields[p]),{ref:h,reset:o,disableActionsOnBlur:v}),n))});case u.Changed:var m=r.payload,g=m.name,y=m.value,b=m.defaultValue,O=e(e({},t),{fields:e(e({},t.fields),(a={},a[g]=e(e({},t.fields[g]),{value:y,defaultValue:b}),a))}),B=Object.values(O.fields).some((function(e){return JSON.stringify(e.value)!==JSON.stringify(e.defaultValue)}));return e(e({},O),{hasChanged:B});default:return t}}!function(e){e[e.Focus=0]="Focus",e[e.Blur=1]="Blur",e[e.Reset=2]="Reset",e[e.Register=3]="Register",e[e.Changed=4]="Changed"}(u||(u={}));var o=function(o){var d=o.children,c=o.onSave,f=o.saveOnBlur,v=void 0!==f&&f,p=o.resetOnBlur,h=void 0===p||p,m=o.status,g=r(l,i),y=g[0],b=g[1],O=n((function(e){var t=e.disableActionsOnBlur,r=void 0!==t&&t,n=e.name,a=e.ref,s=e.reset;b({type:u.Register,payload:{disableActionsOnBlur:r,name:n,ref:a,reset:s}})}),[]),B=n((function(){b({type:u.Focus})}),[]),F=n((function(){null==c||c(Object.entries(y.fields).reduce((function(t,r){var n,a=r[0],s=r[1].value;return e(e({},t),((n={})[a]=s,n))}),{})),b({type:u.Blur,payload:{}})}),[c,y.fields]),C=a((function(){return Object.keys(y.fields).some((function(e){return y.fields[e].disableActionsOnBlur}))}),[y.fields]),j=n((function(e){if(C)return y.hasChanged||b({type:u.Blur,payload:{event:e}}),void(v&&console.warn("An <EditableField.Autocomplete /> component wrapped in an <EditableField.Group /> cannot be saved/reset on blur"));v?F():b({type:u.Blur,payload:{event:e,reset:h}})}),[C,F,h,v,y.hasChanged]),R=n((function(e){var t=e.name,r=e.value,n=e.defaultValue;b({type:u.Changed,payload:{name:t,value:r,defaultValue:n}})}),[]),A=n((function(){b({type:u.Reset})}),[]);return t(s.Provider,{value:{register:O,isFocused:y.isFocused,hasChanged:y.hasChanged,onFocus:B,onBlur:j,onChange:R,onSave:F,onReset:A,status:m},children:d})};export{u as Actions,o as default};
//# sourceMappingURL=EditableFieldGroup.js.map
