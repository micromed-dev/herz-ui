import{__rest as e,__assign as o}from"../../../_virtual/_tslib.js";import{jsxs as t,jsx as n}from"theme-ui/jsx-runtime";import{useState as r,useRef as l,useMemo as i,useCallback as a,useEffect as u}from"react";import{get as d}from"theme-ui";import s from"../../Autocomplete/Autocomplete.js";import c from"../hooks/useEditableFieldGroup.js";import p from"../ButtonControl/ButtonControl.js";var f=function(f){var m,v,g=f.name,h=f.status,b=f.helperText,x=f.onSave,S=f.controlsGroup,O=e(f,["name","status","helperText","onSave","controlsGroup"]),C=r(!1),y=C[0],R=C[1],k=r(!1),B=k[0],F=k[1],j=l(null),w=c(),A=w.hasChanged,G=w.isFocused,I=w.onBlur,E=w.onFocus,T=w.onChange,J=w.onSave,N=w.onReset,_=w.register,L=w.status,V=i((function(){return L||(h||"default")}),[L,h]),W=i((function(){return O.selectedOption}),[O.selectedOption]),X=i((function(){return _?S&&(A||"loading"===V):JSON.stringify(W)!==JSON.stringify(O.defaultSelectedOption)||"loading"===V}),[O.defaultSelectedOption,S,A,_,V,W]),Y=i((function(){return _?G:B}),[B,G,_]),q=a((function(){O.multiSelect?O.defaultSelectedOption&&O.onSelectedItemsChange(O.defaultSelectedOption):O.defaultSelectedOption&&O.onSelectedItemChange(O.defaultSelectedOption)}),[O]),z=a((function(){null==x||x(O.selectedOption)}),[O.selectedOption,x]),D=l(q);u((function(){D.current=q}),[q]),u((function(){g&&(null==T||T({name:g,value:W,defaultValue:O.defaultSelectedOption}))}),[O.defaultSelectedOption,T,g,W]),u((function(){if(_){if(!g)throw"An <EditableField.Autocomplete /> component wrapped in an <EditableField.Group /> needs to have a `name` prop";null==_||_({disableActionsOnBlur:!0,name:g,ref:j,reset:function(){var e;return null===(e=D.current)||void 0===e?void 0:e.call(D)}})}}),[g,_]);var H={active:{backgroundColor:"#fff",color:"text",boxShadow:function(e){return"0px 0px 0px 4px ".concat(d(e,"colors.secondary.alpha.95"))},borderColor:"secondary",fontWeight:"semibold"}};return t("div",{ref:j,onFocus:function(e){null==E||E(e),F(!0)},onBlur:function(e){var o;e.persist(),null==I||I(e);var t=e.relatedTarget;(null===(o=j.current)||void 0===o?void 0:o.contains(t))||_||X||F(!1)},sx:o({borderRadius:2},{default:{},loading:{},success:{backgroundColor:"success.alpha.95"},error:{backgroundColor:"primary.alpha.95"}}[V]),children:[n(p,{isLoading:"loading"===V,showButtons:X,onSave:function(){J?J():z(),F(!1)},onReset:function(){N?N():q(),F(!1)},children:n(s,o({},O,{defaultSelectedOption:void 0,onIsOpenChange:function(e){return R(!!e)},styles:o(o({},null==O?void 0:O.styles),{root:o({borderRadius:2,"&:hover":o({},"default"===V&&{backgroundColor:"text.alpha.95"})},null===(m=null==O?void 0:O.styles)||void 0===m?void 0:m.root),inputRoot:o(o(o(o(o({display:"flex",width:"100%",alignItems:"center",gap:2,paddingY:1,paddingX:3,backgroundColor:"transparent",outline:0,borderRadius:2,border:"2px solid",borderColor:"transparent",color:"text"},{default:{},loading:H.active,success:{borderColor:"success"},error:{borderColor:"primary"}}[V]),{transition:"all 0.2s","&:hover":{}}),(y||Y||X)&&H.active),{"> span":{variant:"text.body1"}}),null===(v=null==O?void 0:O.styles)||void 0===v?void 0:v.inputRoot)})}))}),b&&n("div",{sx:o({px:3,py:2,variant:"text.body1"},{default:{},loading:{},success:{color:"success"},error:{color:"primary"}}[V]),children:b})]})};export{f as default};
//# sourceMappingURL=EditableFieldAutocomplete.js.map
