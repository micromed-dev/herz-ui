import{__assign as r}from"../../../_virtual/_tslib.js";import{jsxs as e,jsx as o}from"theme-ui/jsx-runtime";import{get as n}from"theme-ui";import{forwardRef as t,useRef as a,useImperativeHandle as i,useCallback as l,useEffect as u,useMemo as c}from"react";import d from"../../Icon/Icon.js";import s from"../hooks/useEditableFieldGroup.js";import p from"../ButtonControl/ButtonControl.js";import{autoExpander as f}from"../../Input/Input.js";var v=t((function(t,v){var m=t.value,g=t.defaultValue,x=t.name,h=t.onChange,b=t.status,C=t.helperText,y=void 0===C?"":C,w=t.onSave,k=t.saveOnBlur,I=void 0!==k&&k,j=t.resetOnBlur,F=void 0===j||j,B=t.className,T=t.controlsGroup,G=void 0!==T&&T,z=t.multiline,R=t.rows,S=void 0===R?1:R,V=t.unit,E=a(null),O=a(null);i(v,(function(){return O.current}));var A={active:{borderColor:"secondary",boxShadow:function(r){return"0px 0px 0px 4px ".concat(n(r,"colors.secondary.alpha.90"))},backgroundColor:"#FFF"}},N=l((function(r){var e=Object.create(r);e.type="change",e.target=O.current,e.currentTarget=O.current,O.current&&(O.current.value=g),null==h||h(e)}),[g,h]),_=s(),L=_.hasChanged,X=_.isFocused,Y=_.onBlur,q=_.onFocus,D=_.onChange,H=_.onSave,J=_.onReset,K=_.register,M=_.status,P=a(N);u((function(){P.current=N}),[N]),u((function(){x&&(null==D||D({name:x,value:m,defaultValue:g}))}),[g,D,x,m]),u((function(){if(K){if(!x)throw"An <EditableText /> component wrapped in an <EditableField.Group /> needs to have a `name` prop";null==K||K({name:x,ref:E,reset:function(){var r;return null===(r=P.current)||void 0===r?void 0:r.call(P,{})}})}}),[x,K]),u((function(){f(null==O?void 0:O.current)}),[m]);var Q=c((function(){return M||(b||"default")}),[M,b]),U=c((function(){return K?G&&(L||"loading"===Q):m!==g||"loading"===Q}),[G,g,L,K,Q,m]);return e("div",{ref:E,sx:r({borderRadius:2},{default:{},loading:{},success:{backgroundColor:"success.alpha.95"},error:{backgroundColor:"primary.alpha.95"}}[Q]),onFocus:q,onBlur:function(r){var e,o;if("loading"!==Q){if(Y)return Y(r);(null===(e=E.current)||void 0===e?void 0:e.contains(r.target))&&(null===(o=E.current)||void 0===o?void 0:o.contains(r.relatedTarget))||(I?m!==g&&(null==w||w(m)):F&&N(r))}},className:B,children:[o(p,{isLoading:"loading"===Q,showButtons:U,onSave:function(){if(H)return H();null==w||w(m)},onReset:function(r){if(J)return J();N(r);var e=r.currentTarget;setTimeout((function(){return e.blur()}))},children:e("div",{sx:r(r(r({display:"flex",width:"100%",alignItems:"center",gap:2,paddingY:1,paddingX:3,backgroundColor:"transparent",outline:0,borderRadius:2,border:"2px solid transparent"},{default:{},loading:A.active,success:{borderColor:"success"},error:{borderColor:"primary"}}[Q]),{transition:"all 0.2s","&:hover":r({},"default"===Q&&{backgroundColor:"text.alpha.95"}),"&:focus-within":r({},A.active)}),X?A.active:{}),children:[z?o("textarea",{"aria-invalid":"error"===b,defaultValue:h?void 0:m,disabled:"loading"===b,name:x,onChange:h,onInput:function(r){return f(r.currentTarget)},placeholder:g,ref:O,rows:S,sx:{backgroundColor:"transparent",border:"none",color:"text",flexGrow:1,outline:0,p:0,py:"2px",resize:"none",variant:"text.body1",width:"100%"},value:h?m:void 0}):o("input",{type:"text",ref:O,name:x,value:h?m:void 0,defaultValue:h?void 0:m,placeholder:g,onChange:h,disabled:"loading"===b,"aria-invalid":"error"===b,size:1,sx:{width:"100%",flexGrow:1,outline:0,backgroundColor:"transparent",border:"none",p:0,py:"2px",color:"text",variant:"text.body1"}}),V&&o("label",{sx:{display:"flex",justifyContent:"center",alignItems:"center",color:"text.40"},children:V}),{default:"",error:o(d,{name:"IconAlertCircle",size:16,sx:{color:"primary"}}),loading:"",success:o(d,{name:"IconCircleCheck",size:16,sx:{color:"success"}})}[Q]]})}),y&&o("div",{sx:r({px:3,py:2,variant:"text.body1"},{default:{},loading:{},success:{color:"success"},error:{color:"primary"}}[Q]),children:y})]})}));export{v as default};
//# sourceMappingURL=EditableFieldText.js.map
