import{__rest as e,__assign as t}from"../../../_virtual/_tslib.js";import{jsxs as o,jsx as r}from"theme-ui/jsx-runtime";import{useState as n,useRef as l,useMemo as a,useCallback as u,useEffect as i}from"react";import{get as d}from"theme-ui";import s from"../../Select/Select.js";import{SelectOption as c}from"../../Select/SelectOption.js";import f from"../hooks/useEditableFieldGroup.js";import m from"../ButtonControl/ButtonControl.js";var p=function(c){var p=c.name,v=c.status,h=c.helperText,g=c.onSave,b=c.saveOnBlur,x=void 0!==b&&b,S=c.resetOnBlur,C=void 0===S||S,y=c.controlsGroup,I=c.children,O=e(c,["name","status","helperText","onSave","saveOnBlur","resetOnBlur","controlsGroup","children"]),B=n(!1),j=B[0],k=B[1],w=n(!1),F=w[0],V=w[1],R=l(null),G=f(),E=G.hasChanged,T=G.isFocused,W=G.onBlur,J=G.onFocus,N=G.onChange,_=G.onSave,A=G.onReset,L=G.register,X=G.status,Y=a((function(){return X||(v||"default")}),[X,v]),q=a((function(){return O.multi?O.selectedItems:O.value}),[O.multi,O.selectedItems,O.value]),z=a((function(){return O.multi?O.defaultSelectedItems:O.defaultValue}),[O.defaultSelectedItems,O.defaultValue,O.multi]),D=a((function(){return L?y&&(E||"loading"===Y):JSON.stringify(q)!==JSON.stringify(z)||"loading"===Y}),[y,z,E,L,Y,q]),H=a((function(){return L?T:F}),[F,T,L]),K=u((function(){var e,t;O.multi?O.defaultSelectedItems&&(null===(e=O.onSelectedItemsChange)||void 0===e||e.call(O,O.defaultSelectedItems)):O.defaultValue&&(null===(t=O.onChange)||void 0===t||t.call(O,O.defaultValue))}),[O]),M=u((function(){O.multi?null==g||g(O.selectedItems):null==g||g(O.value)}),[g,O.multi,O.selectedItems,O.value]),P=l(K);i((function(){P.current=K}),[K]),i((function(){p&&(null==N||N({name:p,value:q,defaultValue:z}))}),[z,N,p,q]),i((function(){if(L){if(!p)throw"An <EditableField.Select /> component wrapped in an <EditableField.Group /> needs to have a `name` prop";null==L||L({name:p,ref:R,reset:function(){var e;return null===(e=P.current)||void 0===e?void 0:e.call(P)}})}}),[p,L]);var Q={active:{backgroundColor:"#fff",color:"text",boxShadow:function(e){return"0px 0px 0px 4px ".concat(d(e,"colors.secondary.alpha.95"))},borderColor:"secondary",fontWeight:"semibold"}};return o("div",{ref:R,onFocus:function(e){null==J||J(e),V(!0)},onBlur:function(e){var t,o;null==W||W(e),V(!1);var r=e.relatedTarget;(null===(t=R.current)||void 0===t?void 0:t.contains(r))||(null===(o=null==r?void 0:r.id)||void 0===o?void 0:o.startsWith("downshift"))||(k(!1),L||(x?M():C&&K()))},sx:t({borderRadius:2},{default:{},loading:{},success:{backgroundColor:"success.alpha.95"},error:{backgroundColor:"primary.alpha.95"}}[Y]),children:[r(m,{isLoading:"loading"===Y,showButtons:D,onSave:function(){_?_():M(),V(!1)},onReset:function(){A?A():K(),V(!1)},children:r(s,t({},O,{fullWidth:!0,isOpen:j,onIsOpenChange:k,defaultValue:void 0,defaultSelectedItems:void 0,styles:{root:{borderRadius:2,"&:hover":t({},"default"===Y&&{backgroundColor:"text.alpha.95"})},button:t(t(t(t(t({display:"flex",width:"100%",alignItems:"center",gap:2,paddingY:1,paddingX:3,backgroundColor:"transparent",outline:0,borderRadius:2,border:"2px solid",borderColor:"transparent",color:"text"},{default:{},loading:Q.active,success:{borderColor:"success"},error:{borderColor:"primary"}}[Y]),{transition:"all 0.2s","&:hover":{}}),j&&Q.active),H&&Q.active),{"> span":{variant:"text.body1"}})},children:I}))}),h&&r("div",{sx:t({px:3,py:2,variant:"text.body1"},{default:{},loading:{},success:{color:"success"},error:{color:"primary"}}[Y]),children:h})]})};p.Option=c;export{p as default};
//# sourceMappingURL=EditableFieldSelect.js.map
