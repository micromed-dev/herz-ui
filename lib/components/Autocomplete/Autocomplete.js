import{__assign as e,__spreadArray as t}from"../../_virtual/_tslib.js";import{createElement as n,get as o}from"theme-ui";import{jsx as i,jsxs as r}from"theme-ui/jsx-runtime";import l,{forwardRef as a,useRef as d,useImperativeHandle as c,useMemo as u}from"react";import{useCombobox as s}from"downshift";import p from"../Button/Button.js";import h from"../Popover/Popover.js";import v from"../Tag/Tag.js";import{isBrowser as m}from"../../helpers/ssr.js";var g=a((function(a,g){var f,x,b=(a.multiSelect?a:{keepSearchAfterSelect:!1}).keepSearchAfterSelect,y=void 0!==b&&b,S=a.buttons,C=a.helperText,w=a.id,I=a.label,k=a.onInputValueChange,O=a.onKeyEnter,R=a.validationRegex,T=a.inputTag,V=a.onIsOpenChange,P=a.optionalText,j=a.options,E=a.optionToString,N=void 0===E?function(){return""}:E,B=a.placeholder,F=void 0===B?"":B,W=a.required,J=a.requiredText,K=a.renderOption,Y=a.selectedOption,z=a.status,A=a.styles,D=a.totalCount,L=void 0===D?0:D,q=d(null),M=d(null);c(g,(function(){return M.current}));var X=u((function(){if(a.multiSelect)return{stateReducer:function(t,n){var o=n.changes;switch(n.type){case s.stateChangeTypes.InputKeyDownEnter:case s.stateChangeTypes.ItemClick:return e(e({},o),{isOpen:!0,highlightedIndex:t.highlightedIndex,inputValue:y?t.inputValue:""});case s.stateChangeTypes.InputBlur:return e(e({},o),{inputValue:""});case s.stateChangeTypes.ControlledPropUpdatedSelectedItem:return e(e({},o),{inputValue:y?t.inputValue:""});default:return o}}}}),[y,a.multiSelect]),_=s(e({id:w,items:j,itemToString:N,onInputValueChange:k,onIsOpenChange:function(e){var t,n,o=e.isOpen;o?null===(n=M.current)||void 0===n||n.focus():(a.multiSelect||oe(N(Y)||""),null===(t=M.current)||void 0===t||t.blur()),null==V||V(o)},onSelectedItemChange:function(e){var n=e.selectedItem;if(a.multiSelect){if(!n)return;var o=Y.indexOf(n);o>0?a.onSelectedItemsChange(t(t([],Y.slice(0,o),!0),Y.slice(o+1),!0)):0===o?a.onSelectedItemsChange(t([],Y.slice(1),!0)):a.onSelectedItemsChange(t(t([],Y,!0),[n],!1))}else a.onSelectedItemChange(n)},selectedItem:Y||null},X)),G=_.getComboboxProps,U=_.getInputProps,H=_.getItemProps,Q=_.getLabelProps,Z=_.getMenuProps,$=_.highlightedIndex,ee=_.inputValue,te=_.isOpen,ne=_.openMenu,oe=_.setInputValue,ie={active:{borderColor:"secondary",boxShadow:function(e){return"0px 0px 0px 4px ".concat(o(e,"colors.secondary.alpha.90"))},backgroundColor:"#FFF"}},re=u((function(){return z||"default"}),[z]),le=e({},Object.keys(U()).reduce((function(t,n){var o;return n.includes("aria")?e(e({},t),((o={})[n]=U()[n],o)):t}),{})),ae=u((function(){return a.multiSelect?!!a.selectedOption&&a.selectedOption.length>0:!!a.selectedOption}),[a.multiSelect,a.selectedOption]),de=u((function(){var e=!!a.defaultSelectedOption,t=JSON.stringify(a.selectedOption)!==JSON.stringify(a.defaultSelectedOption);return e?ae&&t||t:ae}),[ae,a.defaultSelectedOption,a.selectedOption]),ce=i("input",e({},U({"aria-label":I?void 0:"autocomplete-input","aria-invalid":"error"===z,autoComplete:"off",disabled:"loading"===z,size:1,onFocus:function(){te||ne()},placeholder:a.multiSelect&&ae?"":F,ref:M,type:"text",value:ee||"",onKeyPress:a.multiSelect&&T?function(e){"Enter"===e.key&&ee&&O&&O(ee)}:void 0,onKeyDown:a.multiSelect?function(e){ee||"Backspace"!==e.key||a.onSelectedItemsChange(Y.slice(0,-1))}:void 0}),{sx:e({backgroundColor:"transparent",border:"none",color:"text",flexGrow:1,opacity:!ae||te?1:0,outline:0,p:0,py:"2px",variant:"text.body1",width:"auto","&:not(focused)":{width:!a.multiSelect||ae&&!te?0:void 0}},null==A?void 0:A.input)}));return r("div",{sx:e({display:"flex",flexDirection:"column",flexWrap:"wrap",gap:2},null==A?void 0:A.root),children:[I&&r("div",{sx:{display:"flex",gap:1},children:[i("label",e({},Q(),{sx:e({color:"text",variant:"text.body1"},null==A?void 0:A.label),children:I})),r("span",{sx:e({color:"text.40",variant:"text.body2"},null==A?void 0:A.labelSideText),children:["(",W?J:P,")"]})]}),i("div",{children:i(h,{isInteractive:!0,appendTo:m?null===document||void 0===document?void 0:document.body:void 0,content:r("div",e({},Z({},{suppressRefError:!0}),{sx:e({display:T?"none":"block",background:"#fff",border:"1px solid #E8E8E9",borderRadius:4,boxShadow:"main",flexWrap:a.multiSelect?"wrap":void 0,minWidth:null===(f=q.current)||void 0===f?void 0:f.getClientRects()[0].width,outline:"0",overflowX:"hidden",overflowY:a.multiSelect?"hidden":"auto",padding:4,transition:"opacity .1s ease","& > div":{cursor:"pointer"},"& > div#total-count":{cursor:"initial"}},null==A?void 0:A.menu),children:[j.map((function(t,o,i){return n("div",e({},H({item:t,index:o}),{key:o}),K({highlightedIndex:$,defaultStyles:{backgroundColor:a.multiSelect&&Y.some((function(e){return JSON.stringify(e)===JSON.stringify(t)}))||$===o?"secondary.alpha.95":void 0,borderRadius:2,padding:2},option:t,inputValue:ee,index:o,array:i}))})),(L>j.length||0===j.length)&&r("div",{id:"total-count",sx:e({backgroundColor:"inherit",bottom:0,color:"text.40",cursor:"none",padding:2,position:"sticky",textAlign:"center",transition:"all 0s",variant:"text.body2","& > span":{color:"text",fontWeight:600}},null==A?void 0:A.counterContainer),children:[L>j.length&&r(l.Fragment,{children:["Currently showing ",i("span",{children:j.length})," results from a total of ",i("span",{children:L}),"."]}),0===j.length&&r("div",{sx:{alignContent:"center",alignItems:"center",color:"text.40",display:"flex",gap:3,justifyContent:"center",transition:"all 0s"},children:["No results found"," ",i(p,{color:"secondary",onClick:function(){oe("")},size:"small",sx:{paddingY:0},variant:"plain",children:"Clear search"})]})]})]})),isVisible:te,placement:"bottom-start",noPadding:!0,children:r("div",e({},G({ref:q}),{sx:e(e(e({alignItems:"center",border:"2px solid transparent",borderRadius:2,display:"flex",gap:2,outline:0,paddingX:3,paddingY:1,position:"relative",transition:"all 0.2s",width:"100%"},{default:{backgroundColor:de?"secondary.alpha.90":"text.alpha.95"},loading:ie.active,success:{backgroundColor:"success.alpha.95",borderColor:"success"},error:{backgroundColor:"primary.alpha.95",borderColor:"primary"}}[re]),{"&:hover":e({},"default"===re&&{backgroundColor:de?"secondary.alpha.85":"text.alpha.90"}),"&:focus-within":e({},te&&ie.active),"& *":{transition:"all 0.2s, visibility 0s"}}),null==A?void 0:A.inputRoot),children:[a.multiSelect&&r("div",e({},le,{onClick:function(){ne()},sx:{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:[a.renderSelectedItems?a.renderSelectedItems(Y,te):Y.map((function(e,t){var n,o,r=!R||R.test(null==e?void 0:e.value);return i(v,{color:r?a.tagColor:"primary",onRemove:function(){var t;return null===(t=a.onRemove)||void 0===t?void 0:t.call(a,e)},showRemove:te&&!!a.onRemove,children:null===(n=a.getOptionLabel)||void 0===n?void 0:n.call(a,e)},"".concat(null===(o=a.getOptionLabel)||void 0===o?void 0:o.call(a,e),"-").concat(t))})),ce]})),!a.multiSelect&&ce,(!Y||te)&&!a.multiSelect&&i(p,e({},le,{"aria-label":"Search",color:"text",iconName:"IconSearch",onClick:function(){var e;null===(e=M.current)||void 0===e||e.focus()},size:"small",sx:{backgroundColor:"transparent","&:hover":{backgroundColor:"transparent"},"&:not([disabled]):hover":{backgroundColor:"transparent"}}})),!te&&Y&&!a.multiSelect&&i("div",e({},le,{onClick:function(){ne()},sx:{overflow:"hidden",position:"absolute",textOverflow:"ellipsis",whiteSpace:"nowrap",width:null===(x=M.current)||void 0===x?void 0:x.getClientRects()[0].width},children:a.renderSelectedItem?a.renderSelectedItem(Y):null==N?void 0:N(Y)})),S&&S.length>0&&Y&&!te&&i("div",{sx:{display:"flex",gap:2,whiteSpace:"nowrap"},children:S.map((function(t,n){var o;return i(p,e({},t,{sx:{borderRadius:0,height:null===(o=q.current)||void 0===o?void 0:o.getClientRects()[0].height,margin:"-8px 0",paddingY:0,"& > button":{borderRadius:0}},children:t.children}),"autocompleteButton-".concat(n))}))})]}))})}),C&&i("div",{sx:e({},{default:{color:"text.40",variant:"text.body2"},loading:{},success:{px:3,pb:2,color:"success",variant:"text.body1"},error:{px:3,pb:2,color:"primary",variant:"text.body1"}}[re]),children:C})]})}));export{g as default};
//# sourceMappingURL=Autocomplete.js.map
